<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Talk:cpp/string/byte/memcpy - cppreference.com</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.21.2" />
<link rel="alternate" type="application/x-wiki" title="Edit" href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=edit" />
<link rel="edit" title="Edit" href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=edit" />
<link rel="shortcut icon" href="../../../../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://en.cppreference.com/mwiki/opensearch_desc.php" title="cppreference.com (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://en.cppreference.com/mwiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="cppreference.com Atom feed" href="http://en.cppreference.com/mwiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="../../../../mwiki/load.php%3Fdebug=false&amp;lang=en&amp;modules=ext.gadget.ColiruCompiler%257Cext.rtlcite%257Cmediawiki.legacy.commonPrint%252Cshared%257Cskins.cppreference2&amp;only=styles&amp;skin=cppreference2&amp;*.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="../../../../mwiki/load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=styles&amp;skin=cppreference2&amp;*.css" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}#toc{display:none}.editsection{display:none}
/* cache key: mwiki1-mwiki_en_:resourceloader:filter:minify-css:7:472787eddcf4605d11de8c7ef047234f */</style>

<script src="../../../../mwiki/load.php%3Fdebug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"Talk","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":1,"wgPageName":"Talk:cpp/string/byte/memcpy","wgTitle":"cpp/string/byte/memcpy","wgCurRevisionId":84403,"wgArticleId":14074,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Talk:cpp/string/byte/memcpy","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":0,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":0,"showtoolbar":1,"skin":"cppreference2","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,
"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"gadget-ColiruCompiler":1});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});;},{},{});
/* cache key: mwiki1-mwiki_en_:resourceloader:filter:minify-js:7:ca03345b1e2c4d90a25d968753a73b92 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/mwiki/skins/cppreference2/csshover.min.htc")}</style><![endif]--></head>
<body class="mediawiki ltr sitedir-ltr ns-1 ns-talk page-Talk_cpp_string_byte_memcpy skin-cppreference2 action-view">
        <!-- header -->
        <div id="mw-head" class="noprint">
            <div id="cpp-head-first-base">
                <div id="cpp-head-first">
                    <h5><a href="http://en.cppreference.com/">
                        cppreference.com                        </a></h5>
                    <div id="cpp-head-search">
                        
<!-- 0 -->
<div id="p-search">
	<h5><label for="searchInput">Search</label></h5>
	<form action="http://en.cppreference.com/mwiki/index.php" id="searchform">
		<input type='hidden' name="title" value="Special:Search"/>
				<div id="simpleSearch">
						<input name="search" title="Search cppreference.com [f]" accesskey="f" id="searchInput" />						<button type="submit" name="button" title="Search the pages for this text" id="searchButton"><img src="../../../../mwiki/skins/cppreference2/images/search-ltr.png%3F303" alt="Search" /></button>					</div>
			</form>
</div>

<!-- /0 -->
                    </div>
                    <div id="cpp-head-personal">
                        
<!-- 0 -->
<div id="p-personal" class="">
<span id="pt-createaccount"><a href="http://en.cppreference.com/mwiki/index.php?title=Special:UserLogin&amp;returnto=Talk%3Acpp%2Fstring%2Fbyte%2Fmemcpy&amp;type=signup">Create account</a></span>	<div class="menu">
        <ul>
<li id="pt-login"><a href="http://en.cppreference.com/mwiki/index.php?title=Special:UserLogin&amp;returnto=Talk%3Acpp%2Fstring%2Fbyte%2Fmemcpy" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>        </ul>
    </div>
</div>

<!-- /0 -->
                    </div>

                </div>
            </div>
            <div id="cpp-head-second-base">
                <div id="cpp-head-second">
                    <div id="cpp-head-tools-left">
                        
<!-- 0 -->
<div id="p-namespaces" class="vectorTabs">
	<h5>Namespaces</h5>
	<ul>
					<li  id="ca-nstab-main"><span><a href="../../../cpp/string/byte/memcpy.html"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="selected"><span><a href="memcpy.html"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" class="vectorMenu emptyPortlet">
		<h5><span>Variants</span><a href="memcpy.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
                    </div>
                    <div id="cpp-head-tools-right">
                        
<!-- 0 -->
<div id="p-views" class="vectorTabs">
	<h5>Views</h5>
	<ul>
					<li id="ca-view" class="selected"><span><a href="memcpy.html" >View</a></span></li>
					<li id="ca-edit" class=" istalk"><span><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=edit"  title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></span></li>
					<li id="ca-addsection" class="collapsible"><span><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=edit&amp;section=new"  title="Start a new section [+]" accesskey="+">+</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">History</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" class="vectorMenu emptyPortlet">
	<h5><span>Actions</span><a href="memcpy.html#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /header -->
        <!-- content -->
        <div id="cpp-content-base">
            <div id="content">
                <a id="top"></a>
                <div id="mw-js-message" style="display:none;"></div>
                                <!-- firstHeading -->
                <h1 id="firstHeading" class="firstHeading">Talk:cpp/string/byte/memcpy</h1>
                <!-- /firstHeading -->
                <!-- bodyContent -->
                <div id="bodyContent">
                                        <!-- tagline -->
                    <div id="siteSub">From cppreference.com</div>
                    <!-- /tagline -->
                                        <!-- subtitle -->
                    <div id="contentSub"><span class="subpages">&lt; <a href="../../../Talk:cpp.1.html" title="Talk:cpp">Talk:cpp</a></span></div>
                    <!-- /subtitle -->
                                                            <!-- bodycontent -->
                    <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>I have some issues with the parts about non-trivially-copyable types. First of all, but maybe that's just me:
</p>
<blockquote>If the objects are not <a href="../../../cpp/concept/TriviallyCopyable.html" title="cpp/concept/TriviallyCopyable"><code>TriviallyCopyable</code></a> (e.g. scalars, arrays, C-compatible structs)</blockquote>
<p>it is not obvious to me from the phrasing if "scalars, arrays, .." are trivially copyable or not.
</p><p>Then, I am rather sure that for certain objects, the invocation of <code>memcpy</code> itself has Undefined Behaviour. Not all C++ objects have memory layouts compatible with the C object model: C++ has noncontiguous objects. See <a rel="nofollow" class="external text" href="http://stackoverflow.com/a/29866102/">my StackOverflow answer</a> for an example. [intro.object]p5 says
</p>
<blockquote>An object of trivially copyable or standard-layout type shall occupy contiguous bytes of storage.</blockquote>
<p>C specifies that objects occupy contiguous bytes in 6.2.6.1p2
I conclude that C++ objects whose types are neither standard-layout nor trivially copyable are not required to be compatible with the C object model. For C++ objects that are incompatible, I'd guess that the behaviour of <code>memcpy</code> is undefined.
</p><p>Additionally, it is unclear to me if <code>memcpy</code> has defined behaviour for standard-layout types that are not trivially copyable. For example, can you change the type of an object via <code>memcpy</code>? - e.g. by copying the value of an object into a character array and from there into an object of a different type? This might have implications for aliasing optimizations; see also <a rel="nofollow" class="external text" href="http://www.open-std.org/pipermail/ub/2013-November/000376.html">this discussion</a>.
</p><p>Until these issues have been resolved unambiguously, I'd suggest either to restrict the description of <code>memcpy</code> to trivially copyable types, or add a warning that the effects on standard-layout types which are not trivially copyable are under discussion + there is no specification for <code>memcpy</code>ing types which are neither standard-layout nor trivially copyable.
</p><p>dyp --<a href="../../../Special:Contributions/91.14.125.125.html" title="Special:Contributions/91.14.125.125">91.14.125.125</a> 18:33, 28 April 2015 (PDT)
</p>
<dl><dd> good point about non-contiguous memory layout! Let's just link to SO. --<a href="../../../User:Cubbi.html" title="User:Cubbi">Cubbi</a> (<a href="../../../User_talk:Cubbi.html" title="User talk:Cubbi">talk</a>) 18:45, 28 April 2015 (PDT)
</dd></dl>
<dl><dd> Wow, you're fast. It occurred to me that even trivially copyable is not sufficient to make <code>memcpy</code> well-behaved. [basic.types]p2 specifically excludes base class subobjects, and sure enough, <a rel="nofollow" class="external text" href="http://coliru.stacked-crooked.com/a/b0c7fdbbdfb20bea"><code>memcpy</code>ing an empty base class subobject has inconsistent behaviour</a>. This of course includes my example using virtual inheritance, but I guess the general argument of noncontiguous objects still holds. dyp --<a href="../../../Special:Contributions/84.171.80.135.html" title="Special:Contributions/84.171.80.135">84.171.80.135</a> 06:51, 29 April 2015 (PDT)
</dd></dl>
<dl><dd><dl><dd> <a rel="nofollow" class="external text" href="http://en.cppreference.com/mwiki/index.php?title=cpp%2Fstring%2Fbyte%2Fmemcpy&amp;diff=13258&amp;oldid=8146">I wrote</a> this quip about trivially-copiable types on this page, so naturally I am interested in how wrong I was. I think when I put it in, I was looking at basic.types/2 and my reasoning was "what is not defined is undefined". I just overlooked the "other than a base-class subobject" bit. --<a href="../../../User:Cubbi.html" title="User:Cubbi">Cubbi</a> (<a href="../../../User_talk:Cubbi.html" title="User talk:Cubbi">talk</a>) 07:03, 29 April 2015 (PDT)
</dd></dl>
</dd></dl>
<hr />
<blockquote>Where strict aliasing prohibits examining the same memory as values of two different types, std::memcpy may be used to convert the values.</blockquote>
<p>This is subject to <a rel="nofollow" class="external text" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3751.pdf">N3751</a> (I'm not sure if there's a DR about it). But that might very well be too far into language-lawyer-land to be of any practical use. That is, even if we follow Dos Reis' interpretation that this is UB, if it's common practice, it might not be worth the trouble pointing out on cppreference that it's currently UB. There's also a <a rel="nofollow" class="external text" href="http://www.open-std.org/pipermail/ub/2013-September/000127.html">related discussion on the UB reflector</a>.
</p><p>dyp --<a href="../../../Special:Contributions/84.171.80.135.html" title="Special:Contributions/84.171.80.135">84.171.80.135</a> 10:22, 29 April 2015 (PDT)
</p>
<dl><dd>As someone who brought plenty of objects into being by memcpy'ng their representations from IPC/network, I home Richard Smith is right. Possible weasel wording: s/may be used/is often used --<a href="../../../User:Cubbi.html" title="User:Cubbi">Cubbi</a> (<a href="../../../User_talk:Cubbi.html" title="User talk:Cubbi">talk</a>) 10:48, 29 April 2015 (PDT)
</dd></dl>
<h3><span class="editsection">[<a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=edit&amp;section=1" title="Edit section: round 2">edit</a>]</span> <span class="mw-headline" id="round_2">round 2</span></h3>
<p>This topic is making <a rel="nofollow" class="external text" href="http://stackoverflow.com/questions/35954909">another round on StackOverflow</a> and more than one person seems to read our "not specified and may be undefined" as "unspecified behavior". --<a href="../../../User:Cubbi.html" title="User:Cubbi">Cubbi</a> (<a href="../../../User_talk:Cubbi.html" title="User talk:Cubbi">talk</a>) 05:47, 18 March 2016 (PDT)
</p>
<!-- 
NewPP limit report
Preprocessor visited node count: 75/1000000
Preprocessor generated node count: 290/1000000
Post‐expand include size: 348/2097152 bytes
Template argument size: 133/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mwiki1-mwiki_en_:pcache:idhash:14074-0!*!0!*!*!*!* and timestamp 20160318124731 -->
</div>                    <!-- /bodycontent -->
                                        <!-- printfooter -->
                    <div class="printfooter">
                    Retrieved from "<a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;oldid=84403">http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;oldid=84403</a>"                    </div>
                    <!-- /printfooter -->
                                                            <!-- catlinks -->
                    <div id='catlinks' class='catlinks catlinks-allhidden'></div>                    <!-- /catlinks -->
                                                            <div class="visualClear"></div>
                    <!-- debughtml -->
                                        <!-- /debughtml -->
                </div>
                <!-- /bodyContent -->
            </div>
        </div>
        <!-- /content -->
        <!-- footer -->
        <div id="cpp-footer-base" class="noprint">
            <div id="footer">
                        <div id="cpp-navigation">
            <h5>Navigation</h5>
            <ul>
<li id="n-Support-us"><a href="http://www.cppreference.com/support" rel="nofollow">Support us</a></li><li id="n-recentchanges"><a href="../../../Special:RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li><li id="n-FAQ"><a href="../../../Cppreference:About.html">FAQ</a></li><li id="n-Offline-version"><a href="../../../Cppreference:Archives.html">Offline version</a></li>            </ul>
        </div>
                        <div id="cpp-toolbox">
            <h5><span>Toolbox</span><a href="memcpy.html#"></a></h5>
            <ul>
<li id="t-whatlinkshere"><a href="../../../Special:WhatLinksHere/Talk:cpp/string/byte/memcpy.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="../../../Special:RecentChangesLinked/Talk:cpp/string/byte/memcpy.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-upload"><a href="http://upload.cppreference.com/w/Special:Upload" title="Upload files [u]" accesskey="u">Upload file</a></li><li id="t-specialpages"><a href="../../../Special:SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;oldid=84403" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="http://en.cppreference.com/mwiki/index.php?title=Talk:cpp/string/byte/memcpy&amp;action=info">Page information</a></li>            </ul>
        </div>
                            <ul id="footer-info">
                                    <li id="footer-info-lastmod"> This page was last modified on 18 March 2016, at 05:47.</li>
                                    <li id="footer-info-viewcount">This page has been accessed 441 times.</li>
                            </ul>
                    <ul id="footer-places">
                                    <li id="footer-places-privacy"><a href="../../../Cppreference:Privacy_policy.html" title="Cppreference:Privacy policy">Privacy policy</a></li>
                                    <li id="footer-places-about"><a href="../../../Cppreference:About.html" title="Cppreference:About">About cppreference.com</a></li>
                                    <li id="footer-places-disclaimer"><a href="../../../Cppreference:General_disclaimer.html" title="Cppreference:General disclaimer">Disclaimers</a></li>
                            </ul>
                                    <ul id="footer-icons" class="noprint">
                                    <li id="footer-poweredbyico">
                                            <a href="http://www.mediawiki.org/"><img src="../../../../mwiki/skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>                                            <a href="http://qbnz.com/highlighter/"><img src="http://upload.cppreference.com/mwiki/images/2/2b/powered_by_geshi_88x31.png" alt="Powered by GeSHi" height="31" width="88" /></a>                                            <a href="http://www.tigertech.net/referral/cppreference.com"><img src="http://upload.cppreference.com/mwiki/images/9/94/powered_by_tigertech_88x31.png" alt="Hosted by Tiger Technologies" height="31" width="88" /></a>                                        </li>
                                </ul>
                        <div style="clear:both">
            </div>
            </div>
        </div>
        <!-- /footer -->
        <script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script src="../../../../mwiki/load.php%3Fdebug=false&amp;lang=en&amp;modules=skins.cppreference2&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest","mediawiki.hidpi","ext.gadget.ColiruCompiler"], null, true);
}</script>
<script src="../../../../mwiki/load.php%3Fdebug=false&amp;lang=en&amp;modules=site&amp;only=scripts&amp;skin=cppreference2&amp;*"></script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-2828341-1']);
_gaq.push(['_setDomainName', 'cppreference.com']);
_gaq.push(['_trackPageview']);
</script><!-- Served in 0.047 secs. -->
	</body>
<!-- Cached 20160318154756 -->
</html>
